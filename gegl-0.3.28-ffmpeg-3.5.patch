--- gegl-0.3.28/operations/external/ff-save.c.omv~	2018-01-29 10:45:32.795497020 +0100
+++ gegl-0.3.28/operations/external/ff-save.c	2018-01-29 10:48:32.911570922 +0100
@@ -290,7 +290,7 @@ add_audio_stream (GeglProperties *o, AVF
   c->codec_type = AVMEDIA_TYPE_AUDIO;
 
   if (oc->oformat->flags & AVFMT_GLOBALHEADER)
-    c->flags |= CODEC_FLAG_GLOBAL_HEADER;
+    c->flags |= AV_CODEC_FLAG_GLOBAL_HEADER;
 
   return st;
 }
@@ -631,7 +631,7 @@ add_video_stream (GeglProperties *o, AVF
 #endif
 
    if (oc->oformat->flags & AVFMT_GLOBALHEADER)
-     c->flags |= CODEC_FLAG_GLOBAL_HEADER;
+     c->flags |= AV_CODEC_FLAG_GLOBAL_HEADER;
 
   return st;
 }
@@ -699,7 +699,7 @@ open_video (GeglProperties *o, AVFormatC
     }
 
   p->video_outbuf = NULL;
-  if (!(oc->oformat->flags & AVFMT_RAWPICTURE))
+  if (!(oc->oformat->video_codec == AV_CODEC_ID_WRAPPED_AVFRAME))
     {
       /* allocate output buffer, 1 mb / frame, might fail for some codecs on UHD - but works for now */
       p->video_outbuf_size = 1024 * 1024;
@@ -803,7 +803,7 @@ write_video_frame (GeglProperties *o,
   picture_ptr      = p->picture;
   picture_ptr->pts = p->frame_count;
 
-  if (oc->oformat->flags & AVFMT_RAWPICTURE)
+  if (oc->oformat->video_codec == AV_CODEC_ID_WRAPPED_AVFRAME)
     {
       /* raw video case. The API will change slightly in the near
          future for that */
